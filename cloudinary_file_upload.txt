===========================================
CLOUDINARY + FILE UPLOAD FLOW (REVISION)
===========================================

-------------------------------------------
WHAT IS CLOUDINARY?
-------------------------------------------
Cloudinary is a cloud-based service for:
- Storing media (images, videos, PDFs)
- Optimizing delivery (resize, format, quality)
- Transforming media on the fly
- Serving files via CDN

Cloudinary stores FILES.
Your backend stores only FILE URLs.


-------------------------------------------
WHY USE CLOUDINARY?
-------------------------------------------
- No local storage management
- Automatic CDN delivery
- Image optimization
- Easy transformations
- Scales automatically


-------------------------------------------
WHAT CLOUDINARY IS NOT
-------------------------------------------
✘ A database
✘ A file parser
✘ Authentication system

(Multer handles parsing, Cloudinary handles storage)


-------------------------------------------
CLOUDINARY CONFIGURATION
-------------------------------------------
Cloudinary must be configured ONCE
when the server starts.

cloudinary.config({
  cloud_name,
  api_key,
  api_secret
})

DO NOT configure Cloudinary:
✘ per request
✘ inside controllers
✘ inside utils repeatedly


-------------------------------------------
ROLE OF MULTER
-------------------------------------------
Multer:
- Parses multipart/form-data
- Extracts file from request
- Stores it temporarily
- Exposes it as req.file / req.files

Cloudinary:
- Uploads that file to cloud storage


-------------------------------------------
FULL FILE UPLOAD FLOW (MERN)
-------------------------------------------
1. User selects file in browser
2. Frontend sends FormData
3. HTTP request uses multipart/form-data
4. Multer parses request
5. File appears as req.file
6. Cloudinary uploads file
7. Cloudinary returns secure URL
8. Backend saves URL in database
9. Backend sends response to client


-------------------------------------------
FRONTEND (REACT)
-------------------------------------------
const formData = new FormData();
formData.append("image", file);

fetch("/api/upload", {
  method: "POST",
  body: formData
});


-------------------------------------------
BACKEND ROUTE
-------------------------------------------
router.post(
  "/upload",
  authMiddleware,
  upload.single("image"),
  uploadController
);


-------------------------------------------
CONTROLLER LOGIC
-------------------------------------------
- Check req.file exists
- Call Cloudinary upload
- Get secure_url
- Save URL to DB
- Send response


-------------------------------------------
UTILS / CLOUDINARY FUNCTION
-------------------------------------------
uploadImage(filePath) {
  return cloudinary.uploader.upload(filePath);
}


-------------------------------------------
WHY TEMP STORAGE IS USED
-------------------------------------------
Multer stores files temporarily because:
- Validation is needed
- Upload may fail
- Files should not stay on server

After upload:
✔ Temp file can be deleted


-------------------------------------------
TRANSFORMATIONS (CLOUDINARY)
-------------------------------------------
Images can be transformed by URL:

- Resize
- Crop
- Auto-format
- Auto-quality

Example:
cloudinary.url("imageId", {
  width: 300,
  height: 300,
  crop: "fill"
})


-------------------------------------------
MULTIPLE FILE UPLOAD FLOW
-------------------------------------------
- upload.array("images", 5)
- req.files (array)
- Upload each file to Cloudinary
- Save all URLs


-------------------------------------------
COMMON MISTAKES
-------------------------------------------
✘ Expecting req.file without Multer
✘ Uploading files on module import
✘ Storing files in MongoDB
✘ Configuring Cloudinary multiple times
✘ No file validation
✘ No error handling


-------------------------------------------
SECURITY BEST PRACTICES
-------------------------------------------
- Limit file size
- Validate MIME type
- Authenticate upload routes
- Store only URLs in DB
- Never expose Cloudinary secret


-------------------------------------------
INTERVIEW ONE-LINER
-------------------------------------------
“Multer handles multipart/form-data and extracts files,
Cloudinary stores and optimizes media,
and the backend saves only the returned URLs.”


-------------------------------------------
FINAL MENTAL MODEL
-------------------------------------------
Multer  → file parser
Cloudinary → file storage + CDN
Controller → business logic
Database → URLs only
